<!DOCTYPE html>
<html lang="en">
	<head>
		<title>AP3.0 Technical Demo</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link href="css/main.css" rel="stylesheet" />

		<script src="../libs/Detector.js"></script>
		<script src="../libs/stats.min.js"></script>
		<script src="../libs/signals.min.js"></script>
		<script src="../libs/dat.gui.min.js"></script>

		<script src="../libs/three/three.min.js"></script>
		<script src="../libs/three/controls/TrackballControls.js"></script>
		<script src="../libs/utils.js"></script>

		<!-- <script src="../dist/all.min.js"></script> -->
		<script src="js/audiopixel.js"></script>
		<script src="js/api.js"></script>
		<script src="js/managers/AppManager.js"></script>
		<script src="js/managers/PortManager.js"></script>
		<script src="js/managers/HardwareManager.js"></script>
		<script src="js/managers/ChannelManager.js"></script>
		<script src="js/objects/Port.js"></script>
		<script src="js/objects/Channel.js"></script>
		<script src="js/objects/Pod.js"></script>
		<script src="js/objects/Clip.js"></script>
		<script src="js/objects/PodPosition.js"></script>

		<script src="js/shaders/MainShader.js"></script>
		<script src="js/shaders/PointCloudShader.js"></script>
		<script src="js/shaders/ShaderUtils.js"></script>
		<script src="js/shaders/SimpleTextureShader.js"></script>

		<script src="import/datGuiPresets.js"></script>

		<script src="import/shaders/SolidColorClip.js"></script>
		<script src="import/shaders/TestFrameClip.js"></script>
		<script src="import/shaders/DiSinSwirlClip.js"></script>
		<script src="import/shaders/ColorSineBarClip.js"></script>
		<script src="import/shaders/ColorSwirlsClip.js"></script>
		<script src="import/shaders/LineCosSinClip.js"></script>
		<script src="import/shaders/SimpleSwirlClip.js"></script>
		<script src="import/shaders/SinSpiralClip.js"></script>
		<script src="import/shaders/SineParticlesClip.js"></script>
		<script src="import/shaders/WaterClip.js"></script>
		<script src="import/shaders/HexifyRadialClip.js"></script>
		<script src="import/shaders/SinCosTanClip.js"></script>
		<script src="import/shaders/HueFxClip.js"></script>
		<script src="import/shaders/TestFxClip.js"></script>
		<script src="import/shaders/BasicTestClip.js"></script>

		<script src="import/nodes/test.js"></script>
		<script src="import/presets/testPreset.js"></script>

		<script src="ui/datguiSetup1.js"></script>

		<script>

			if ( !Detector.webgl ) { Detector.addGetWebGLMessage(); } else {

				var glWidth = window.innerWidth;
				var glHeight = window.innerHeight;

				var scene;
				var renderer;
				var camera;
				var controls;

				var container;
				var stats;

				function onLoad(){

					// Three.js setup
					scene = new THREE.Scene();

					renderer = new THREE.WebGLRenderer( /*{ preserveDrawingBuffer: readPixels } */); // Some browsers might need preserveDrawingBuffer to readPixels
					renderer.setSize( glWidth, glHeight );
					renderer.autoClear = false;

					container = document.getElementById( 'container' );
					container.appendChild( renderer.domElement ); 

					camera = new THREE.PerspectiveCamera( 30, glWidth / glHeight, 1, 100000 );
					camera.position.z = 2000;
					controls = new THREE.TrackballControls( camera, renderer.domElement);


					// Initialize ap
					var maxNodeCount = 10000;
					ap.init(scene, renderer, maxNodeCount);
					ap.setSize(glWidth, glHeight);


					// Init UI, dat.gui handling MVC setup for now (yes even state). defined in "ui/datguiSetup1.js"
					initUi();


					// Display stats
					stats = new Stats();
					stats.domElement.style.position = 'absolute';
					stats.domElement.style.top = '0px';
					document.getElementById( 'container' ).appendChild( stats.domElement );

					// Start the main loop
					animate();
					
				}

				function animate() {

					// Main update loop
					if(ap.ready){
						stats.update();
						ap.update();
						controls.update();
						renderer.render( scene, camera );
					}

					requestAnimationFrame( animate );
				}


				// Resize logic
				function onWindowResize() {

					glWidth = window.innerWidth;
					glHeight = window.innerHeight;

					ap.setSize(glWidth, glHeight);

					camera.aspect = glWidth / glHeight;
					camera.updateProjectionMatrix();
					controls.handleResize();

				}

				window.addEventListener( 'resize', onWindowResize, false );

			}

		</script>

	</head>

	<body ontouchstart="" onload="onLoad()">

		<div id="container"></div>

	</body>

</html>